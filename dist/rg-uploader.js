!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jQuery")):"function"==typeof define&&define.amd?define(["jQuery"],t):"object"==typeof exports?exports.RG_Uploader=t(require("jQuery")):e.RG_Uploader=t(e.jQuery)}(window,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="./",i(i.s=1)}([function(t,i){t.exports=e},function(e,t,i){e.exports=i(4)},function(e,t,i){},function(e,t,i){},function(e,t,i){"use strict";i.r(t);var n={};i.r(n),i.d(n,"bytesToSize",function(){return l}),i.d(n,"findDOM",function(){return u}),i.d(n,"getUniqueNumber",function(){return p}),i.d(n,"detectTouchEvent",function(){return d}),i.d(n,"inputFileReset",function(){return c}),i.d(n,"getFunctionReturn",function(){return h}),i.d(n,"checkFunction",function(){return f});var o={};i.r(o),i.d(o,"loading",function(){return w}),i.d(o,"error",function(){return $}),i.d(o,"complete",function(){return _});var s={};i.r(s),i.d(s,"ChangeQueue",function(){return E}),i.d(s,"ChangeQueueStyle",function(){return k}),i.d(s,"DragAndDrop",function(){return z}),i.d(s,"Preview",function(){return F}),i.d(s,"SizeInfo",function(){return j}),i.d(s,"Thumbnail",function(){return D});var r=i(0),a=i.n(r);function l(e){if(0===e)return"0";const t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","KB","MB","GB","TB"][t]}function u(e,t,i){return e&&e.length?e.find("[data-"+t+"="+i+"]"):null}function p(e){e=e||10;const t=(+new Date).toString().split("").reverse();let i="";for(let s=0;s<e;++s){i+=t[(n=0,o=t.length-1,Math.floor(Math.random()*(o-n+1))+n)]}var n,o;return parseInt(i)}function d(){return"ontouchstart"in document.documentElement}function c(e){let t=!!navigator.userAgent.match(/Trident.*rv[ :]?[1-9]{2}\./),i=-1!==navigator.appVersion.indexOf("MSIE ");if(-1!==navigator.appVersion.indexOf("MSIE 10"))e.type="radio",e.type="file";else if(i||t){const t=e.parentNode,i=e.nextSibling;let n=document.createElement("form");n.appendChild(e),n.reset(),t.insertBefore(e,i)}else e.value=""}function h(e,t,i){return e&&"function"==typeof e&&e(t,i)||t}function f(e){return e&&"function"==typeof e}var m=function(e,t,i,n,o){const s=a.a.Deferred();if(e&&"string"==typeof e){const r=new XMLHttpRequest;if("function"==typeof FormData||"object"==typeof FormData){let a=new FormData;if(a.append("file",t),i&&"object"==typeof i)for(let e in i)a.append(e,i[e]);r.open("post",e,!0),n&&"object"==typeof n&&Object.keys(n).forEach(function(e){r.setRequestHeader(e,n[e])}),r.upload.addEventListener("progress",function(e){s.notify(function(e){if(e.lengthComputable)return{loaded:e.loaded,total:e.total}}(e),t)},!1),r.addEventListener("load",function(e){let i=function(e,t){if(4===e.readyState)switch(e.status){case 200:let t=e.responseText;try{return JSON.parse(t)||t}catch(e){return{state:"error",response:{message:t}}}break;case 404:return{state:"error",response:{message:"404 - File not found"}};case 403:return{state:"error",response:{message:"403 - Forbidden file type"}};default:return{state:"error",response:{message:"Unknown Error"}}}return{state:"error",response:{message:"Unknown Error"}}}(e.target);switch((i=o(i)).state){case"success":s.resolve(i.response,t);break;case"error":s.reject(i.message,t)}}),r.send(a)}else s.reject("not support browser",t)}else if(FileReader){let e=new FileReader;e.onload=(e=>{s.resolve({src:e.target.result,isLocalFile:!0},t)}),e.readAsDataURL(t)}else s.reject("not support browser",t);return s.promise()},g={autoUpload:!1,externalFileForm:null,allowFileTypes:["jpeg","png","gif","jpg"],limitSize:1e7,limitSizeTotal:3e7,uploadScript:null,removeScript:null,uploadHeaders:null,removeHeaders:null,eventPrefixName:"RG-",srcPrefixName:"",queue:{height:150,limit:10,style:"list",buttons:[{name:"remove queue",iconName:"close",className:"btn-remove-queue",action:function(e,t){e.queue.removeQueue(t.id,!1,!0)}}],datas:null},plugin:[],uploadScriptFunc:null,removeScriptFunc:null,uploadParamsFilter:null,uploadDataFilter:null,removeParamsFilter:null,removeDataFilter:null,uploadProgress:null,uploadComplete:null,uploadCompleteAll:null,uploadFail:null,init:null};const v={ko:{error_add_upload:"업로드가 끝난후에 추가해주세요.",error_upload_limit:"파일은 총 {0}개까지 업로드할 수 있습니다.",error_limit_size:"업로드할 수 있는 용량이 초과되었습니다.",error_limit_size2:"파일용량을 초과한 파일은 제외됩니다.",error_file_type:"잘못된 형식의 파일입니다.",error_check_file:"허용되지 않는 파일은 제외됩니다.",error_not_upload_file:"업로드할 파일이 없습니다.",error_remove_error:"파일을 삭제하는중에 오류가 발생했습니다.",error_import:"데이터 가져오기 실패",error_now_uploading:"지금 업로드중입니다."},en:{error_add_upload:"Please add after upload.",error_upload_limit:"Files can be uploaded to a total of {0}.",error_limit_size:"The capacity that can be uploaded has been exceeded.",error_limit_size2:"Files exceeding the file capacity are excluded.",error_file_type:"Invalid file.",error_check_file:"Do not allow files are excluded.",error_not_upload_file:"There are no files to upload.",error_remove_error:"Deleting file error.",error_import:"Data import failed.",error_now_uploading:"Uploading now."}};function y(e,t){let i=a()("html").attr("lang")||"ko",n=v[i][e]||"";return n=t&&t.length?function(e,t){return e.replace(/{(\d+)}/g,function(e,i){return void 0!==t[i]?t[i]:e})}(n,t):n}var b=function(e,t){const i=e,n=function(e){let t={};return(e=e||[]).forEach(e=>{if(!e.key||!e.code)return!1;t[e.key]=e.code}),t}(t);this.pressKeyCode=null,this.isPressKeyCode=!1;const o=e=>{this.pressKeyCode=e.keyCode,this.isPressKeyCode=e.keyCode===n.ctrl||e.keyCode===n.cmd,a()(window).off("keydown."+i).on("keyup."+i,s)},s=e=>{this.pressKeyCode=null,this.isPressKeyCode=!1,a()(window).off("keyup."+i).on("keydown."+i,o)};a()(window).on("keydown."+i,o)};const w='<li class="loading ready"><div class="wrap"><figure class="col not-image"><p data-element="progress" style="width: 40%;"><span><em>40</em>%</span></p></figure><div class="col bar"><p data-element="progress" style="width: 30%;"><span><em>30</em>%</span></p></div><div class="col bd"><span class="name" data-text="filename">filename.jpg</span><hr><span class="state" data-text="state">ready</span></div><nav class="col" data-element="removeQueue"><button type="button" title="remove queue"><i class="material-icons">close</i></button></nav></div></li>',$='<li class="error"><div class="wrap"><figure class="col not-image"></figure><div class="col bd"><span class="filetype bracket large" data-text="filetype">image/jpg</span><span class="name" data-text="filename">filename.jpg</span><hr><span class="state" data-text="state">upload fail</span></div></div></li>',_='<li class="complete"><div class="wrap"><figure class="col" data-element="previewImage" data-text="filename">filename.jpg</figure><div class="col bd"><span class="filetype bracket large" data-text="filetype">image/jpg</span><span class="name" data-text="filename">filename.jpg</span><hr><span class="state" data-text="state">uploaded</span><span class="size bracket" data-text="filesize">123.43kb</span></div><nav class="col" data-element="customButtons"></nav></div></li>';class S{constructor(e){this.parent=e,this.name="Uploader",this.queue=e.queue,this.$uploadElement=null,this.readyItems=[],this.uploading=!1;const t=n.findDOM(e.$container,"element","startUpload");this.$uploadElement=n.findDOM(e.$container,"element","addFiles"),this.addUploadElements(a()(e.options.externalFileForm)),this.$uploadElement&&this.$uploadElement.length&&(this.$uploadElement.each((t,i)=>{a()(i).on("change",()=>{this.pushReady(),e.options.autoUpload&&this.start()})}),t&&t.length&&t.on("click",()=>(this.start(),!1)))}static getTotalReadySize(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].size;return t}static mergeFileList(e){let t=[];return e.each((e,i)=>{for(let e=0;e<i.files.length;e++)t.push(i.files[e])}),t}pushReadyUploadFiles(e){let t=this.parent.options,i=t.queue.limit,o={type:!1,extension:!1,filesize:!1},s=[];function r(e,t){!1===o[e]&&(alert(t),o[e]=!0)}if(this.parent.queue.items.ids.length+e.length>i)return alert(y("error_upload_limit",[t.queue.limit])),!1;let a=this.parent.queue.getSize()+this.constructor.getTotalReadySize(this.readyItems)+this.constructor.getTotalReadySize(e);if(t.limitSizeTotal<a)return alert(y("error_limit_size")),!1;for(let i=0;i<e.length;i++)e[i].type?t.allowFileTypes.indexOf(e[i].type.split("/")[1])<0?r("extension",y("error_check_file")):e[i].size>t.limitSize?r("filesize",y("error_limit_size2")):(e[i].id=n.getUniqueNumber(),this.readyItems.push(e[i]),s.push(e[i])):r("type",y("error_file_type"));s.forEach(e=>{this.parent.queue.addProgress(e)})}pushReady(){let e=this.constructor.mergeFileList(this.$uploadElement);if(!e.length)return alert(y("error_not_upload_file")),!1;this.pushReadyUploadFiles(e),this.resetEvent(this.$uploadElement)}start(e=[]){e&&e.length&&this.pushReadyUploadFiles(e),this.uploading?alert(y("error_now_uploading")):this.play()}play(){const{options:e}=this.parent;if(!this.readyItems.length)return;this.uploading=!0;let t=this.parent.queue.selectQueueElement(this.readyItems[0].id);t.removeClass("ready"),n.findDOM(t,"text","state").text("loading..."),n.findDOM(t,"element","removeQueue").remove();let i=n.checkFunction(e.uploadParamsFilter)&&e.uploadParamsFilter(this.readyItems[0],this.parent);m(n.getFunctionReturn(e.uploadScriptFunc,e.uploadScript),this.readyItems[0],i,e.uploadHeaders,t=>n.checkFunction(e.uploadDataFilter)?e.uploadDataFilter(t,this.parent):t).done((e,t)=>{this.uploadComplete("success",e,t)}).progress((e,t)=>{this.uploadProgress(e,t)}).fail((e,t)=>{this.uploadComplete("error",e,t)})}uploadProgress(e,t){this.parent.queue.updateProgress({id:t.id,data:e}),this.parent.options.uploadProgress&&this.parent.options.uploadProgress(e,t,this.parent)}uploadComplete(e,t,i){switch(e){case"success":delete(i=a.a.extend({},i,t)).slice,this.parent.queue.uploadResult("success",i),this.parent.options.uploadComplete&&this.parent.options.uploadComplete(i,this.parent);break;case"error":i.message=t,this.parent.queue.uploadResult("error",i),console.error("ERROR:",i.message),n.checkFunction(this.parent.options.uploadFail)&&this.parent.options.uploadFail(i,this.parent)}this.readyItems.splice(0,1),this.readyItems.length?this.play():(this.uploading=!1,this.parent.options.uploadCompleteAll&&"function"==typeof this.parent.options.uploadCompleteAll&&this.parent.options.uploadCompleteAll(this.parent),this.parent.eventReceiver("queue.uploadCompleteAll"))}addUploadElements(e){this.$uploadElement&&this.$uploadElement.length?this.$uploadElement=this.$uploadElement.add(e):this.$uploadElement=e}resetEvent(e){(e||this.$uploadElement).each((e,t)=>{n.inputFileReset(t)})}}class C{constructor(e){this.name="Queue",this.parent=e,this.options=e.options.queue,this.items={ids:[],files:[]},this.style="list",this.$queue=n.findDOM(e.$container,"element","queue").children("ul"),this.keyboardEvent=new b(e.options.eventPrefixName,[{key:"ctrl",code:17},{key:"cmd",code:91}])}init(){this.options.height&&n.findDOM(this.parent.$container,"comp","queue").height(this.options.height),this.changeStyle(this.options.style),this.options.datas&&this.import(this.options.datas)}initSelectQueueEvent(e){e.on("click",e=>this.selectQueue(a()(e.currentTarget).data("id")))}createNavigationButtons(e,t){if(!e||!e.length)return;let i=[];return e.forEach(e=>{if(!e.name||!e.iconName||!e.action)return;if(e.show&&!1===e.show(t))return;let n=e.className?`class="${e.className}"`:"",o=a()(`<button type="button" title="${e.name}" ${n}>`+`<i class="material-icons">${e.iconName}</i>`+"</button>");o.on("click",i=>{e.action(this.parent,t),i.stopPropagation()}),i.push(o)}),i}findItem(e){let t=this.items.ids.indexOf(Number(e));return"number"==typeof t?t:void 0}changeStyle(e){this.$queue.removeClass(`style-${this.style}`).addClass(`style-${e}`),this.style=e,this.parent.eventReceiver("queue.changeStyle",{style:e})}import(e){e&&("string"==typeof e?a.a.get(e,e=>{if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}e&&e instanceof Array?e.length&&e.forEach(e=>{this.addComplete(e)}):alert(y("error_import"))}):e instanceof Array&&e.forEach(e=>{this.addComplete(e)}))}delete(e){e&&e.length&&e.forEach(e=>{this.removeQueue(e,!1,!0)})}selectQueue(e){const t=this.$queue.children();if(e){let i=this.selectQueueElement(e);if(this.keyboardEvent.isPressKeyCode)i.toggleClass("selected");else{let e=i.hasClass("selected"),n=t.filter(".selected").length;t.removeClass("selected"),(!e||n>1)&&i.addClass("selected")}}else t.filter(".selected").length>0?t.removeClass("selected"):t.addClass("selected");this.parent.eventReceiver("queue.selectQueue",{$selectElements:this.$queue.children(".selected"),$selectElement:e?this.selectQueueElement(e):t.eq(0)})}selectQueueElement(e=null){return this.$queue.children(`li[data-id=${e}]`)}add(e){e.fullSrc=this.parent.options.srcPrefixName+e.src,this.items.ids.push(Number(e.id)),this.items.files.push(e)}remove(e){let t=this.findItem(e);this.items.ids.splice(t,1),this.items.files.splice(t,1)}addProgress(e){let t=a()(o.loading),i=n.findDOM(t,"element","removeQueue").children("button");this.add(e),t.attr("data-id",e.id),n.findDOM(t,"text","filename").text(e.name),n.findDOM(t,"element","progress").width("0%").find("em").text("0"),i.on("click",e=>{const t=parseInt(a()(e.currentTarget).closest("li").data("id"));this.removeQueue(t,!0,!1),this.parent.uploader.readyItems.forEach((e,i)=>{if(e.id===t)return this.parent.uploader.readyItems.splice(i,1),!1})}),this.$queue.append(t),this.parent.eventReceiver("queue.addProgress",{$el:t,file:e})}addComplete(e,t=null){let i=e.id,s=a()(o.complete),r=n.findDOM(s,"element","previewImage"),l=n.findDOM(s,"element","customButtons"),u=n.findDOM(s,"text","filetype"),p=n.findDOM(s,"text","filename"),d=n.findDOM(s,"text","state"),c=n.findDOM(s,"text","filesize");this.add(e),s.attr("data-id",i),u.text(e.type),p.text(e.name),d.text("uploaded"),c.text(e.size?n.bytesToSize(e.size):"none"),l.html(""),"image"===e.type.split("/")[0]&&r.css("background-image",`url(${e.fullSrc})`),this.initSelectQueueEvent(s);let h=this.createNavigationButtons(this.options.buttons,e);h&&h.length&&l.append(h),t&&t.length?t.after(s):this.$queue.append(s),this.parent.eventReceiver("queue.uploadComplete",{$selectElement:s,id:i,file:e})}addError(e,t){const i=e.id,s=a()(o.error),r=n.findDOM(s,"text","filetype"),l=n.findDOM(s,"text","filename"),u=n.findDOM(s,"text","state");this.add(e),s.attr("data-id",i),r.text(e.type),l.text(e.name),u.text(e.message),t&&t.length?t.after(s):this.$queue.append(s),setTimeout(()=>{this.removeQueue(i,!1,!1)},3e3)}removeQueue(e,t,i=!1){const o=this,s=this.parent,{options:r}=s;function l(e){o.selectQueueElement(e).fadeOut(400,function(){a()(this).remove(),o.remove(e),o.parent.eventReceiver("queue.removeQueue",{})})}if(t)this.selectQueueElement(e).filter(".loading").remove(),this.parent.eventReceiver("queue.removeQueue",{});else{let t=this.items.files[this.findItem(e)];if(t<0)return console.error("Not found queue id"),!1;i&&r.removeScript&&!t.isLocalFile?(n.checkFunction(r.removeParamsFilter)&&(t=r.removeParamsFilter(t,this.parent)),a.a.ajax({url:n.getFunctionReturn(r.removeScriptFunc,r.removeScript,t),type:"post",data:t,headers:r.removeHeaders?r.removeHeaders:r.uploadHeaders?r.uploadHeaders:null,success:function(t,i){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={state:"error",response:t}}if(n.checkFunction(r.removeDataFilter)&&(t=r.removeDataFilter(t,s)),!t||!t.state||"success"!==t.state)return alert(y("error_remove_error")),!1;l(e)}})):l(e)}}updateProgress(e){let t=this.$queue.children(`li[data-id=${e.id}]`),i=n.findDOM(t,"element","progress");if(!e||!e.data)return;let o=parseInt(e.data.loaded/e.data.total*100);i.width(`${o}%`).find("em").text(o),this.parent.eventReceiver("queue.updateProgress",{$selectElement:t,id:e.id,loaded:e.data.loaded,total:e.data.total})}uploadResult(e,t){if(!e)return!1;let i=this.selectQueueElement(t.id);switch(this.remove(t.id),e){case"success":this.addComplete(t,i);break;case"error":this.addError(t,i)}this.removeQueue(t.id,!0)}getSize(){let e=0;return this.items.files.forEach(t=>{e+=t.size}),e}changeId(e,t){if(void 0===t)return;const{files:i,ids:n}=this.items;let o=this.findItem(e);if(void 0!==o){let s=this.selectQueueElement(e)[0];s&&s.setAttribute("data-id",t),n[o]=t,i[o].id=t}}}class q{constructor(e){this.parent=e,this.names=[],this.child={}}eventListener(e,t){this.names.forEach(i=>{let n=this.child[i].eventListener;n&&"function"==typeof n&&n(e,t)})}error(e){this.names.splice(this.names.indexOf(e),1),delete this.child[e]}init(){let e=this.parent.options.plugin;e&&e.length&&e.forEach(e=>{e.name&&e.obj&&"object"==typeof e.obj&&e.obj.init&&"function"==typeof e.obj.init&&(this.names.push(e.name),this.child[e.name]=e.obj,this.child[e.name].init(this.parent))})}}function x(e,t){this.name="Change Queue",this.sortable=null;var i=t||i||jQuery,n=this,o=null;function s(){for(var e=[],t=[],s=o.queue.$queue.children("li").map(function(){return o.queue.findItem(i(this).data("id"))}),r=0;r<s.length;r++)e.push(o.queue.items.ids[s[r]]),t.push(o.queue.items.files[s[r]]);o.queue.items.ids=e,o.queue.items.files=t,n.options.endChangeItem&&"function"==typeof n.options.endChangeItem&&n.options.endChangeItem(o)}i&&(this.init=function(t){o=t,this.options=this.assignOption(e),function(){var e=i.Deferred();if(n.options.class_sortable&&"Sortable"===n.options.class_sortable.name)return window.loadedVendorSortable=!0,window.Sortable=n.options.class_sortable,setTimeout(e.resolve,100),e.promise();if(window.loadedVendorSortable)e.resolve();else{var t=document.getElementsByTagName("head")[0],o=document.createElement("script");o.src=n.options.url_sortable,t.appendChild(o);var s=setInterval(function(){try{Sortable&&(clearInterval(s),window.loadedVendorSortable=!0,e.resolve())}catch(e){}},50)}return e.promise()}().done(function(){o.queue.$queue.addClass("rg-plugin-changeQueue"),n.options.vendorOptions.onEnd=s,n.sortable=new Sortable(o.queue.$queue.get(0),n.options.vendorOptions)})},this.eventListener=function(e,t){switch(e){case"queue.uploadCompleteAll":s()}},this.assignOption=function(e){return Object.assign({},this.options,e)})}x.prototype.options={class_sortable:null,url_sortable:"https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js",vendorOptions:{animation:150},endChangeItem:null};var E=x;var k=function(e,t){var i=t||i||jQuery,n=this,o=null;function s(){i.each(n.buttonsParams,function(e,t){var s=i('<button type="button" class="style-'+t.name+'" title="'+t.title+'" data-style="'+t.name+'"><i class="material-icons">'+t.iconName+"</i></button>");!function(e){e.on("click",function(e){if(i(this).hasClass("on"))return!1;o.queue.changeStyle(i(this).data("style"))})}(s),n.$nav.append(s)}),n.$buttons=n.$nav.children("button")}function r(){n.$buttons.removeClass("on").filter(".style-"+name).addClass("on")}i&&(this.name="Change Queue Style",this.buttonsParams=[{name:"list",title:"list style",iconName:"menu",default:!0},{name:"web",title:"web style",iconName:"view_list",default:!1},{name:"album",title:"album style",iconName:"view_module",default:!1}],this.$nav=null,this.$buttons=null,this.init=function(t){o=t;var a=e?i(e):o.$container.children("header");n.$nav=i('<nav data-element="selectQueueStyle"></nav>'),a.append(n.$nav),s(),r(o.queue.style)},this.eventListener=function(e,t){switch(e){case"queue.changeStyle":r(t.style)}})};var z=function(e,t){this.name="Drag And Drop",this.areaElements=[];var i=t||i||jQuery,n=this,o=null;if(i){var s=function(e){if(o.uploader.uploading)return alert(o.lang("error_add_upload")),!1;o.uploader.start(e||[])};this.init=function(t){o=t;var r=e?i(e):null;if(this.areaElements.push(o.queue.$queue.parent().get(0)),r&&r.each(function(){n.areaElements.push(this)}),this.areaElements.length){var a=function(e){if(!(window.File&&window.FileList&&window.FileReader&&window.Blob))return!1;if(!e.length)return!1;for(var t=i.Deferred(),n=!1,o=function(e){if(e.stopPropagation(),e.preventDefault(),"dragover"===e.type){if(n)return!1;n=!0,i(e.currentTarget).addClass("drop-mode"),e.dataTransfer.dropEffect="copy"}else n=!1,i(e.currentTarget).removeClass("drop-mode");return!1},s=function(e){e.stopPropagation(),e.preventDefault(),o(e);var i=e.dataTransfer?e.dataTransfer.files:null;return i&&i.length&&t.notify(i),!1},r=0;r<e.length;r++)e[r].addEventListener("dragover",o,!1),e[r].addEventListener("dragleave",o,!1),e[r].addEventListener("drop",s,!1);return t.promise()}(this.areaElements);a&&a.progress&&a.progress(s)}}}};var F=function(e){this.name="Preview",this.$preview=null;var t=e||t||jQuery,i=this,n=null,o=150;if(t){var s=function(e){var t=i.$preview.children("figure");e?t.css("backgroundImage","url('"+e+"')").removeClass("not-image"):t.attr("style","").addClass("not-image")};this.init=function(e){n=e,o=parseInt(n.options.queue.height||e.$container.find(".body").height()),e.$container.find(".body").height(o),i.$preview=t('<div class="col preview"><figure></figure></div>'),i.$preview.width(o),n.$container.find("[data-comp=queue]").prepend(i.$preview),s()},this.eventListener=function(e,t){switch(e){case"queue.selectQueue":var o=t.$selectElement.data("id"),r=n.queue.findItem(o),a=n.queue.items.files[r],l=t.$selectElement.hasClass("selected")&&"image"===a.type.split("/")[0]?a.fullSrc:null;s(l);break;case"queue.changeStyle":"list"===t.style?i.$preview.removeClass("hide"):i.$preview.addClass("hide")}}}};var j=function(e,t){this.name="Size info",this.size={current:0,total:0};var i=t||i||jQuery,n=this,o=null,s=null,r=null,a=null;function l(e){if(0===e)return"0";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","KB","MB","GB","TB"][t]}i&&(this.init=function(t){o=t,(s=e?i(e):o.$container.find(".size-info")).length||o.plugin.error(name),s.append('<p>Size : <em data-text="currentSize"></em>/<em data-text="totalSize"></em></p>'),r=s.find("[data-text=currentSize]"),a=s.find("[data-text=totalSize]"),this.size.total=o.options.limitSizeTotal,this.update()},this.update=function(){r.text(l(this.size.current)),a.text(l(this.size.total))},this.eventListener=function(e,t){switch(e){case"queue.uploadComplete":n.size.current+=t.file.size,n.update(o.queue.getSize());break;case"queue.removeQueue":n.size.current=o.queue.getSize(),n.update()}})};function O(e,t){this.name="Make thumbnail";var i=t||i||jQuery,n=this,o=null,s="resize.rgUploader",r=!1,a=null;function l(e){if(!e&&r)return!1;r=!0,n.$el.wrap.width("100%").height("100%").css({marginLeft:0,marginTop:0,left:0,top:0}),n.croppie&&d(!0)}function u(e){if(!e&&!r)return!1;r=!1,n.$el.wrap.width(n.options.width).height(n.options.height).css({marginLeft:0-.5*n.options.width+"px",marginTop:0-.5*n.options.height+"px",left:"50%",top:"50%"}),n.croppie&&d(!0)}function p(e){var t=i(window);if(!n.croppie)return clearTimeout(a),!1;a&&clearTimeout(a),a=setTimeout(function(){if(r&&t.width()<640)return l(!0),!1;t.width()<640?l(!0):t.width()>640&&u(!0)},300)}function d(e){var t=e?n.croppie.get():{};c(),n.options.croppie.boundary={width:n.options.mobileSize>i(window).width()?i(window).width():n.options.width,height:(n.options.mobileSize>i(window).width()?i(window).height():n.options.height)-60},n.croppie=new Croppie(n.$el.figure.get(0),n.options.croppie),e&&n.rebind({src:n.file.fullSrc,points:t.points},function(){n.croppie.setZoom(t.zoom)})}function c(){n.croppie&&(n.croppie.destroy(),n.croppie=null)}function h(e){n.croppie.result(n.options.output).then(function(e){n.options.uploadScript?i.post(n.options.uploadScript,{name:n.file.name,image:e,id:f()},function(e){try{e=JSON.parse(e)}catch(e){return alert("parse error"),!1}if("error"===e.state)return alert(e.response.message),!1;n.options.doneCallback&&n.options.doneCallback(e.response,o,n.file)}):n.options.doneCallback&&n.options.doneCallback({id:f(),name:"thumb-"+n.file.name,src:e,type:"image/"+n.options.output.format,size:0},o,n.file),n.close()},function(e){console.log("ERROR",e)})}function f(e){e=e||10;for(var t,i,n=(+new Date).toString().split("").reverse(),o="",s=0;s<e;++s){o+=n[(t=0,i=n.length-1,Math.floor(Math.random()*(i-t+1))+t)]}return parseInt(o)}i&&(this.file=null,this.croppie=null,this.$el={con:null,wrap:null,bg:null,figure:null,meta:null,btn_close:null,btn_done:null},this.init=function(t){o=t,this.assignOption(e),function(){if(!window.loadedCroppie){var e=document.getElementsByTagName("head")[0],t=!!n.options.class_croppie&&"Croppie"===n.options.class_croppie.name;if(t&&(window.Croppie=n.options.class_croppie),!t&&n.options.url_croppieJS){var i=document.createElement("script");i.src=n.options.url_croppieJS,e.appendChild(i)}if(n.options.url_croppieCSS){var o=document.createElement("link");o.rel="stylesheet",o.href=n.options.url_croppieCSS,e.appendChild(o)}window.loadedCroppie=!0}}(),n.$el.con=i('<div class="rg-plugin-thumbnail"><span class="bg"></span><div class="wrap"><div class="img-wrap"><figure></figure></div><div class="body"><div class="meta"><p>message</p></div><nav><button type="button" class="btn-done"><i class="material-icons">done</i></button><button type="button" class="btn-close"><i class="material-icons">close</i></button></nav></div></div></div>'),n.$el.wrap=n.$el.con.children(".wrap"),n.$el.bg=n.$el.con.children(".bg"),n.$el.figure=n.$el.con.find(".img-wrap figure"),n.$el.meta=n.$el.con.find(".meta > p"),n.$el.btn_done=n.$el.con.find(".btn-done"),n.$el.btn_close=n.$el.con.find(".btn-close"),i("body").append(n.$el.con),n.$el.bg.on("click",function(){n.close()}),n.$el.btn_close.on("click",function(){n.close()}),n.$el.btn_done.on("click",h),i(window).on(s,p)},this.open=function(e,t){t=t||{},this.$el.con.addClass("show"),i("html").addClass("rg-popup"),this.file=e,i(window).width()<this.options.mobileSize?l(!0):u(!0),d(),this.rebind({src:this.file.fullSrc,points:t.points,orientation:t.orientation},function(){n.croppie.setZoom(t.zoom||.1)}),this.$el.meta.text("output size: "+this.options.output.size.width+"*"+this.options.output.size.height),this.options.openCallback&&this.options.openCallback(o)},this.close=function(){c(),this.file=null,this.$el.con.removeClass("show"),i("html").removeClass("rg-popup"),this.options.closeCallback&&this.options.closeCallback(o)},this.rebind=function(e,t){this.croppie.bind({url:e.src,points:e.points?e.points:[],orientation:e.orientation?e.orientation:1},function(){t&&t()})},this.assignOption=function(e){this.options=i.extend(!0,this.options,e)})}O.prototype.options={width:640,height:480,mobileSize:640,class_croppie:null,url_croppieCSS:"https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.4/croppie.min.css",url_croppieJS:"https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.4/croppie.min.js",uploadScript:"",output:{type:"canvas",quality:.75,format:"jpeg",size:{width:150,height:150}},croppie:{enableOrientation:!0,boundary:{width:640,height:420},viewport:{width:150,height:150,type:"square"}},doneCallback:null,openCallback:null,closeCallback:null};var D=O;i(2),i(3),t.default=class{constructor(e,t=null){e&&(this.options={...g,...t},t&&t.queue&&(this.options.queue={...g.queue,...t.queue}),this.plugins=s,this.$container=a()(e),this.plugin=new q(this),this.queue=new C(this),this.uploader=new S(this),this.plugin.init(),this.queue.init(),this.options.init&&"function"==typeof this.options.init&&this.options.init(this))}eventReceiver(e,t){this.plugin.eventListener(e,t)}}}]).default});