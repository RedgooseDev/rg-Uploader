(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root.RG_ChangeQueue=factory(jQuery)}})(this,function($){function RG_ChangeQueue(options){this.name="Change Queue";this.sortable=null;var self=this;var app=null;function loadVendorSortable(){var defer=$.Deferred();if(self.options.class_sortable&&self.options.class_sortable.name==="Sortable"){window.loadedVendorSortable=true;window.Sortable=self.options.class_sortable;setTimeout(defer.resolve,100);return defer.promise()}if(window.loadedVendorSortable){defer.resolve()}else{var head=document.getElementsByTagName("head")[0];var scriptElement=document.createElement("script");scriptElement.src=self.options.url_sortable;head.appendChild(scriptElement);var n=0;var interval=setInterval(function(){n++;try{if(Sortable){clearInterval(interval);window.loadedVendorSortable=true;defer.resolve()}}catch(e){}},50)}return defer.promise()}function change(){var newIds=[];var newFiles=[];var index=app.queue.$queue.children("li").map(function(){return app.queue.findItem($(this).data("id"))});for(var i=0;i<index.length;i++){newIds.push(app.queue.items.ids[index[i]]);newFiles.push(app.queue.items.files[index[i]])}app.queue.items.ids=newIds;app.queue.items.files=newFiles;if(self.options.endChangeItem&&typeof self.options.endChangeItem==="function"){self.options.endChangeItem(app)}}function initEvent(){self.options.vendorOptions.onEnd=change;self.sortable=new Sortable(app.queue.$queue.get(0),self.options.vendorOptions)}this.init=function(parent){app=parent;this.options=this.assignOption(options);var vendor=loadVendorSortable();vendor.done(function(){app.queue.$queue.addClass("rg-plugin-changeQueue");initEvent()})};this.eventListener=function(type,value){switch(type){case"queue.uploadCompleteAll":change();break}};this.assignOption=function(obj){return $.extend(true,this.options,obj)}}RG_ChangeQueue.prototype.options={class_sortable:null,url_sortable:"https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js",vendorOptions:{animation:150},endChangeItem:null};return RG_ChangeQueue});(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root.RG_ChangeQueueStyle=factory(jQuery)}})(this,function($){function RG_ChangeQueueStyle(selector){var self=this;var app=null;this.name="Change Queue Style";this.buttonsParams=[{name:"list",title:"list style",iconName:"menu",default:true},{name:"web",title:"web style",iconName:"view_list",default:false},{name:"album",title:"album style",iconName:"view_module",default:false}];this.$nav=null;this.$buttons=null;function createButtons(){$.each(self.buttonsParams,function(k,o){var $el=$('<button type="button" class="style-'+o.name+'" title="'+o.title+'" data-style="'+o.name+'">'+'<i class="material-icons">'+o.iconName+"</i>"+"</button>");initButtonsEvent($el);self.$nav.append($el)});self.$buttons=self.$nav.children("button")}function initButtonsEvent($el){$el.on("click",function(e){if($(this).hasClass("on"))return false;app.queue.changeStyle($(this).data("style"))})}function changeActiveButton(){self.$buttons.removeClass("on").filter(".style-"+name).addClass("on")}this.init=function(parent){app=parent;var $body=!!selector?$(selector):app.$container.children("header");self.$nav=$('<nav data-element="selectQueueStyle"></nav>');$body.append(self.$nav);createButtons();changeActiveButton(app.queue.style)};this.eventListener=function(type,value){switch(type){case"queue.changeStyle":changeActiveButton(value.style);break}}}return RG_ChangeQueueStyle});(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root.RG_DragAndDrop=factory(jQuery)}})(this,function($){function RG_DragAndDrop(el){this.name="Drag And Drop";this.areaElements=[];var self=this;var app=null;var fileDragAndDrop=function(area){if(!window.File||!window.FileList||!window.FileReader||!window.Blob)return false;if(!area.length)return false;var defer=$.Deferred();var over=false;var overHandler=function(e){e.stopPropagation();e.preventDefault();if(e.type==="dragover"){if(over)return false;over=true;$(e.currentTarget).addClass("drop-mode");e.dataTransfer.dropEffect="copy"}else{over=false;$(e.currentTarget).removeClass("drop-mode")}return false};var dropHandler=function(e){e.stopPropagation();e.preventDefault();overHandler(e);var files=e.dataTransfer?e.dataTransfer.files:null;if(files&&files.length){defer.notify(files)}return false};for(var i=0;i<area.length;i++){area[i].addEventListener("dragover",overHandler,false);area[i].addEventListener("dragleave",overHandler,false);area[i].addEventListener("drop",dropHandler,false)}return defer.promise()};var done=function(files){if(app.uploader.uploading){alert(app.lang("error_add_upload"));return false}app.uploader.start(files||[])};this.init=function(parent){app=parent;var externalAreaElements=!!el?$(el):null;this.areaElements.push(app.queue.$queue.parent().get(0));if(externalAreaElements){externalAreaElements.each(function(){self.areaElements.push(this)})}if(this.areaElements.length){var dnd=fileDragAndDrop(this.areaElements);if(dnd&&dnd.progress){dnd.progress(done)}}}}return RG_DragAndDrop});(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root.RG_Preview=factory(jQuery)}})(this,function($){function RG_Preview(){this.name="Preview";this.$preview=null;var self=this;var app=null;var classNameNotImage="not-image";var width=150;var createPreview=function(){var str='<div class="col preview"><figure></figure></div>';self.$preview=$(str);self.$preview.width(width);app.$container.find("[data-comp=queue]").prepend(self.$preview);updatePreview()};var updatePreview=function(src){var $figure=self.$preview.children("figure");if(src){$figure.css("backgroundImage","url('"+src+"')").removeClass(classNameNotImage)}else{$figure.attr("style","").addClass(classNameNotImage)}};var visiblePreview=function(sw){if(sw){self.$preview.removeClass("hide")}else{self.$preview.addClass("hide")}};this.init=function(parent){app=parent;width=parseInt(app.options.queue.height||parent.$container.find(".body").height());parent.$container.find(".body").height(width);createPreview()};this.eventListener=function(type,value){switch(type){case"queue.selectQueue":var id=value.$selectElement.data("id");var n=app.queue.findItem(id);var file=app.queue.items.files[n];var src=value.$selectElement.hasClass("selected")&&file.type.split("/")[0]==="image"?file.fullSrc:null;updatePreview(src);break;case"queue.changeStyle":visiblePreview(value.style==="list");break}}}return RG_Preview});(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root.RG_SizeInfo=factory(jQuery)}})(this,function($){function RG_SizeInfo(selector){this.name="Size info";this.size={current:0,total:0};var self=this;var app=null;var $body=null;var $current=null;var $total=null;function create(){var str='<p>Size : <em data-text="currentSize"></em>/<em data-text="totalSize"></em></p>';$body.append(str);$current=$body.find("[data-text=currentSize]");$total=$body.find("[data-text=totalSize]")}function bytesToSize(bytes){var sizes=["Bytes","KB","MB","GB","TB"];if(bytes===0)return"0";var i=parseInt(Math.floor(Math.log(bytes)/Math.log(1024)));return Math.round(bytes/Math.pow(1024,i),2)+""+sizes[i]}this.init=function(parent){app=parent;if(selector){$body=$(selector)}else{$body=app.$container.find(".size-info")}if(!$body.length){app.plugin.error(name)}create();this.size.total=app.options.limitSizeTotal;this.update()};this.update=function(){$current.text(bytesToSize(this.size.current));$total.text(bytesToSize(this.size.total))};this.eventListener=function(type,value){switch(type){case"queue.uploadComplete":self.size.current+=value.file.size;self.update(app.queue.getSize());break;case"queue.removeQueue":self.size.current=app.queue.getSize();self.update();break}}}return RG_SizeInfo});(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root.RG_Thumbnail=factory(jQuery)}})(this,function($){function RG_Thumbnail(options){this.name="Make thumbnail";var self=this;var app=null;var RESIZE_EVENT="resize.rgUploader";var isMobile=false;var resizeInterval=null;this.file=null;this.croppie=null;this.$el={con:null,wrap:null,bg:null,figure:null,meta:null,btn_close:null,btn_done:null};function loadExternalFiles(){if(window.loadedCroppie)return;var head=document.getElementsByTagName("head")[0];var isCroppie=!!self.options.class_croppie&&self.options.class_croppie.name==="Croppie";if(isCroppie){window.Croppie=self.options.class_croppie}if(!isCroppie&&self.options.url_croppieJS){var scriptEl=document.createElement("script");scriptEl.src=self.options.url_croppieJS;head.appendChild(scriptEl)}if(self.options.url_croppieCSS){var cssEl=document.createElement("link");cssEl.rel="stylesheet";cssEl.href=self.options.url_croppieCSS;head.appendChild(cssEl)}window.loadedCroppie=true}function createContainer(){self.$el.con=$('<div class="rg-plugin-thumbnail">'+'<span class="bg"></span>'+'<div class="wrap">'+'<div class="img-wrap"><figure></figure></div>'+'<div class="body">'+'<div class="meta"><p>message</p></div>'+"<nav>"+'<button type="button" class="btn-done"><i class="material-icons">done</i></button>'+'<button type="button" class="btn-close"><i class="material-icons">close</i></button>'+"</nav>"+"</div>"+"</div>"+"</div>");self.$el.wrap=self.$el.con.children(".wrap");self.$el.bg=self.$el.con.children(".bg");self.$el.figure=self.$el.con.find(".img-wrap figure");self.$el.meta=self.$el.con.find(".meta > p");self.$el.btn_done=self.$el.con.find(".btn-done");self.$el.btn_close=self.$el.con.find(".btn-close");$("body").append(self.$el.con)}function initEvents(){self.$el.bg.on("click",function(){self.close()});self.$el.btn_close.on("click",function(){self.close()});self.$el.btn_done.on("click",done);$(window).on(RESIZE_EVENT,resize)}function actMobile(pass){if(!pass&&isMobile)return false;isMobile=true;self.$el.wrap.width("100%").height("100%").css({marginLeft:0,marginTop:0,left:0,top:0});if(self.croppie){rebuildCroppie(true)}}function actDesktop(pass){if(!pass&&!isMobile)return false;isMobile=false;self.$el.wrap.width(self.options.width).height(self.options.height).css({marginLeft:0-self.options.width*.5+"px",marginTop:0-self.options.height*.5+"px",left:"50%",top:"50%"});if(self.croppie){rebuildCroppie(true)}}function resize(e){var $win=$(window);if(!self.croppie){clearTimeout(resizeInterval);return false}if(resizeInterval){clearTimeout(resizeInterval)}resizeInterval=setTimeout(function(){if(isMobile&&$win.width()<640){actMobile(true);return false}if($win.width()<640){actMobile(true)}else if($win.width()>640){actDesktop(true)}},300)}function rebuildCroppie(isResize){var save=isResize?self.croppie.get():{};destroyCroppie();self.options.croppie.boundary={width:self.options.mobileSize>$(window).width()?$(window).width():self.options.width,height:(self.options.mobileSize>$(window).width()?$(window).height():self.options.height)-60};self.croppie=new Croppie(self.$el.figure.get(0),self.options.croppie);if(isResize){self.rebind({src:self.file.fullSrc,points:save.points},function(){self.croppie.setZoom(save.zoom)})}}function destroyCroppie(){if(self.croppie){self.croppie.destroy();self.croppie=null}}function done(e){self.croppie.result(self.options.output).then(function(res){if(self.options.uploadScript){$.post(self.options.uploadScript,{name:self.file.name,image:res,id:getUniqueNumber()},function(res){try{res=JSON.parse(res)}catch(e){alert("parse error");return false}if(res.state==="error"){alert(res.response.message);return false}if(self.options.doneCallback){self.options.doneCallback(res.response,app,self.file)}})}else{if(self.options.doneCallback){self.options.doneCallback({id:getUniqueNumber(),name:"thumb-"+self.file.name,src:res,type:"image/"+self.options.output.format,size:0},app,self.file)}}self.close()},function(error){console.log("ERROR",error)})}function getUniqueNumber(length){length=length||10;var timestamp=+new Date;var _getRandomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};var ts=timestamp.toString();var parts=ts.split("").reverse();var id="";for(var i=0;i<length;++i){var index=_getRandomInt(0,parts.length-1);id+=parts[index]}return parseInt(id)}this.init=function(parent){app=parent;this.assignOption(options);loadExternalFiles();createContainer();initEvents()};this.open=function(file,bind){bind=bind||{};this.$el.con.addClass("show");$("html").addClass("rg-popup");this.file=file;if($(window).width()<this.options.mobileSize){actMobile(true)}else{actDesktop(true)}rebuildCroppie();this.rebind({src:this.file.fullSrc,points:bind.points,orientation:bind.orientation},function(){self.croppie.setZoom(bind.zoom||.1)});this.$el.meta.text("output size: "+this.options.output.size.width+"*"+this.options.output.size.height);if(this.options.openCallback){this.options.openCallback(app)}};this.close=function(){destroyCroppie();this.file=null;this.$el.con.removeClass("show");$("html").removeClass("rg-popup");if(this.options.closeCallback){this.options.closeCallback(app)}};this.rebind=function(options,callback){this.croppie.bind({url:options.src,points:options.points?options.points:[],orientation:options.orientation?options.orientation:1},function(){if(callback)callback()})};this.assignOption=function(obj){this.options=$.extend(true,this.options,obj)}}RG_Thumbnail.prototype.options={width:640,height:480,mobileSize:640,class_croppie:null,url_croppieCSS:"https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.css",url_croppieJS:"https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.js",uploadScript:"",output:{type:"canvas",quality:.75,format:"jpeg",size:{width:150,height:150}},croppie:{enableOrientation:true,boundary:{width:640,height:480-60},viewport:{width:150,height:150,type:"square"}},doneCallback:null,openCallback:null,closeCallback:null};return RG_Thumbnail});