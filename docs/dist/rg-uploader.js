!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jQuery")):"function"==typeof define&&define.amd?define(["jQuery"],t):"object"==typeof exports?exports.core=t(require("jQuery")):(e.RG_Uploader=e.RG_Uploader||{},e.RG_Uploader.core=t(e.jQuery))}(window,function(e){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="./",i(i.s=3)}([function(t,i){t.exports=e},function(e,t,i){},function(e,t,i){},function(e,t,i){"use strict";i.r(t);var r={};i.r(r),i.d(r,"bytesToSize",function(){return a}),i.d(r,"findDOM",function(){return l}),i.d(r,"getUniqueNumber",function(){return u}),i.d(r,"detectTouchEvent",function(){return d}),i.d(r,"inputFileReset",function(){return p}),i.d(r,"getFunctionReturn",function(){return c}),i.d(r,"checkFunction",function(){return h});var s={};i.r(s),i.d(s,"loading",function(){return b}),i.d(s,"error",function(){return _}),i.d(s,"complete",function(){return x});var n=i(0),o=i.n(n);function a(e){if(0===e)return"0";const t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","KB","MB","GB","TB"][t]}function l(e,t,i){return e&&e.length?e.find("[data-"+t+"="+i+"]"):null}function u(e){e=e||10;const t=(+new Date).toString().split("").reverse();let i="";for(let n=0;n<e;++n){i+=t[(r=0,s=t.length-1,Math.floor(Math.random()*(s-r+1))+r)]}var r,s;return parseInt(i)}function d(){return"ontouchstart"in document.documentElement}function p(e){let t=!!navigator.userAgent.match(/Trident.*rv[ :]?[1-9]{2}\./),i=-1!==navigator.appVersion.indexOf("MSIE ");if(-1!==navigator.appVersion.indexOf("MSIE 10"))e.type="radio",e.type="file";else if(i||t){const t=e.parentNode,i=e.nextSibling;let r=document.createElement("form");r.appendChild(e),r.reset(),t.insertBefore(e,i)}else e.value=""}function c(e,t,i){return e&&"function"==typeof e&&e(t,i)||t}function h(e){return e&&"function"==typeof e}var f=function(e,t,i,r,s){const n=o.a.Deferred();if(e&&"string"==typeof e){const o=new XMLHttpRequest;if("function"==typeof FormData||"object"==typeof FormData){let a=new FormData;if(a.append("file",t),i&&"object"==typeof i)for(let e in i)a.append(e,i[e]);o.open("post",e,!0),r&&"object"==typeof r&&Object.keys(r).forEach(function(e){o.setRequestHeader(e,r[e])}),o.upload.addEventListener("progress",function(e){n.notify(function(e){if(e.lengthComputable)return{loaded:e.loaded,total:e.total}}(e),t)},!1),o.addEventListener("load",function(e){let i=function(e,t){if(4===e.readyState)switch(e.status){case 200:let t=e.responseText;try{return JSON.parse(t)||t}catch(e){return{state:"error",response:{message:t}}}break;case 404:return{state:"error",response:{message:"404 - File not found"}};case 403:return{state:"error",response:{message:"403 - Forbidden file type"}};default:return{state:"error",response:{message:"Unknown Error"}}}return{state:"error",response:{message:"Unknown Error"}}}(e.target);switch((i=s(i)).state){case"success":n.resolve(i.response,t);break;case"error":n.reject(i.message,t)}}),o.send(a)}else n.reject("not support browser",t)}else if(FileReader){let e=new FileReader;e.onload=(e=>{n.resolve({src:e.target.result,isLocalFile:!0},t)}),e.readAsDataURL(t)}else n.reject("not support browser",t);return n.promise()},m={autoUpload:!1,externalFileForm:null,allowFileTypes:["jpeg","png","gif","jpg"],limitSize:1e7,limitSizeTotal:3e7,uploadScript:null,removeScript:null,uploadHeaders:null,removeHeaders:null,eventPrefixName:"RG-",srcPrefixName:"",queue:{height:150,limit:10,style:"list",buttons:[{name:"remove queue",iconName:"close",className:"btn-remove-queue",action:function(e,t){e.queue.removeQueue(t.id,!1,!0)}}],datas:null},plugin:[],uploadScriptFunc:null,removeScriptFunc:null,uploadParamsFilter:null,uploadDataFilter:null,removeParamsFilter:null,removeDataFilter:null,uploadProgress:null,uploadComplete:null,uploadCompleteAll:null,uploadFail:null,init:null};const g={ko:{error_add_upload:"업로드가 끝난후에 추가해주세요.",error_upload_limit:"파일은 총 {0}개까지 업로드할 수 있습니다.",error_limit_size:"업로드할 수 있는 용량이 초과되었습니다.",error_limit_size2:"파일용량을 초과한 파일은 제외됩니다.",error_file_type:"잘못된 형식의 파일입니다.",error_check_file:"허용되지 않는 파일은 제외됩니다.",error_not_upload_file:"업로드할 파일이 없습니다.",error_remove_error:"파일을 삭제하는중에 오류가 발생했습니다.",error_import:"데이터 가져오기 실패",error_now_uploading:"지금 업로드중입니다."},en:{error_add_upload:"Please add after upload.",error_upload_limit:"Files can be uploaded to a total of {0}.",error_limit_size:"The capacity that can be uploaded has been exceeded.",error_limit_size2:"Files exceeding the file capacity are excluded.",error_file_type:"Invalid file.",error_check_file:"Do not allow files are excluded.",error_not_upload_file:"There are no files to upload.",error_remove_error:"Deleting file error.",error_import:"Data import failed.",error_now_uploading:"Uploading now."}};function y(e,t){let i=o()("html").attr("lang")||"ko",r=g[i][e]||"";return r=t&&t.length?function(e,t){return e.replace(/{(\d+)}/g,function(e,i){return void 0!==t[i]?t[i]:e})}(r,t):r}var v=function(e,t){const i=e,r=function(e){let t={};return(e=e||[]).forEach(e=>{if(!e.key||!e.code)return!1;t[e.key]=e.code}),t}(t);this.pressKeyCode=null,this.isPressKeyCode=!1;const s=e=>{this.pressKeyCode=e.keyCode,this.isPressKeyCode=e.keyCode===r.ctrl||e.keyCode===r.cmd,o()(window).off("keydown."+i).on("keyup."+i,n)},n=e=>{this.pressKeyCode=null,this.isPressKeyCode=!1,o()(window).off("keyup."+i).on("keydown."+i,s)};o()(window).on("keydown."+i,s)};const b='<li class="loading ready"><div class="wrap"><figure class="col not-image"><p data-element="progress" style="width: 40%;"><span><em>40</em>%</span></p></figure><div class="col bar"><p data-element="progress" style="width: 30%;"><span><em>30</em>%</span></p></div><div class="col bd"><span class="name" data-text="filename">filename.jpg</span><hr><span class="state" data-text="state">ready</span></div><nav class="col" data-element="removeQueue"><button type="button" title="remove queue"><i class="material-icons">close</i></button></nav></div></li>',_='<li class="error"><div class="wrap"><figure class="col not-image"></figure><div class="col bd"><span class="filetype bracket large" data-text="filetype">image/jpg</span><span class="name" data-text="filename">filename.jpg</span><hr><span class="state" data-text="state">upload fail</span></div></div></li>',x='<li class="complete"><div class="wrap"><figure class="col" data-element="previewImage" data-text="filename">filename.jpg</figure><div class="col bd"><span class="filetype bracket large" data-text="filetype">image/jpg</span><span class="name" data-text="filename">filename.jpg</span><hr><span class="state" data-text="state">uploaded</span><span class="size bracket" data-text="filesize">123.43kb</span></div><nav class="col" data-element="customButtons"></nav></div></li>';class E{constructor(e){this.parent=e,this.name="Uploader",this.queue=e.queue,this.$uploadElement=null,this.readyItems=[],this.uploading=!1;const t=r.findDOM(e.$container,"element","startUpload");this.$uploadElement=r.findDOM(e.$container,"element","addFiles"),this.addUploadElements(o()(e.options.externalFileForm)),this.$uploadElement&&this.$uploadElement.length&&(this.$uploadElement.each((t,i)=>{o()(i).on("change",()=>{this.pushReady(),e.options.autoUpload&&this.start()})}),t&&t.length&&t.on("click",()=>(this.start(),!1)))}static getTotalReadySize(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].size;return t}static mergeFileList(e){let t=[];return e.each((e,i)=>{for(let e=0;e<i.files.length;e++)t.push(i.files[e])}),t}pushReadyUploadFiles(e){let t=this.parent.options,i=t.queue.limit,s={type:!1,extension:!1,filesize:!1},n=[];function o(e,t){!1===s[e]&&(alert(t),s[e]=!0)}if(this.parent.queue.items.ids.length+e.length>i)return alert(y("error_upload_limit",[t.queue.limit])),!1;let a=this.parent.queue.getSize()+this.constructor.getTotalReadySize(this.readyItems)+this.constructor.getTotalReadySize(e);if(t.limitSizeTotal<a)return alert(y("error_limit_size")),!1;for(let i=0;i<e.length;i++)e[i].type?t.allowFileTypes.indexOf(e[i].type.split("/")[1])<0?o("extension",y("error_check_file")):e[i].size>t.limitSize?o("filesize",y("error_limit_size2")):(e[i].id=r.getUniqueNumber(),this.readyItems.push(e[i]),n.push(e[i])):o("type",y("error_file_type"));n.forEach(e=>{this.parent.queue.addProgress(e)})}pushReady(){let e=this.constructor.mergeFileList(this.$uploadElement);if(!e.length)return alert(y("error_not_upload_file")),!1;this.pushReadyUploadFiles(e),this.resetEvent(this.$uploadElement)}start(e=[]){e&&e.length&&this.pushReadyUploadFiles(e),this.uploading?alert(y("error_now_uploading")):this.play()}play(){const{options:e}=this.parent;if(!this.readyItems.length)return;this.uploading=!0;let t=this.parent.queue.selectQueueElement(this.readyItems[0].id);t.removeClass("ready"),r.findDOM(t,"text","state").text("loading..."),r.findDOM(t,"element","removeQueue").remove();let i=r.checkFunction(e.uploadParamsFilter)&&e.uploadParamsFilter(this.readyItems[0],this.parent);f(r.getFunctionReturn(e.uploadScriptFunc,e.uploadScript),this.readyItems[0],i,e.uploadHeaders,t=>r.checkFunction(e.uploadDataFilter)?e.uploadDataFilter(t,this.parent):t).done((e,t)=>{this.uploadComplete("success",e,t)}).progress((e,t)=>{this.uploadProgress(e,t)}).fail((e,t)=>{this.uploadComplete("error",e,t)})}uploadProgress(e,t){this.parent.queue.updateProgress({id:t.id,data:e}),this.parent.options.uploadProgress&&this.parent.options.uploadProgress(e,t,this.parent)}uploadComplete(e,t,i){switch(e){case"success":delete(i=o.a.extend({},i,t)).slice,this.parent.queue.uploadResult("success",i),this.parent.options.uploadComplete&&this.parent.options.uploadComplete(i,this.parent);break;case"error":i.message=t,this.parent.queue.uploadResult("error",i),console.error("ERROR:",i.message),r.checkFunction(this.parent.options.uploadFail)&&this.parent.options.uploadFail(i,this.parent)}this.readyItems.splice(0,1),this.readyItems.length?this.play():(this.uploading=!1,this.parent.options.uploadCompleteAll&&"function"==typeof this.parent.options.uploadCompleteAll&&this.parent.options.uploadCompleteAll(this.parent),this.parent.eventReceiver("queue.uploadCompleteAll"))}addUploadElements(e){this.$uploadElement&&this.$uploadElement.length?this.$uploadElement=this.$uploadElement.add(e):this.$uploadElement=e}resetEvent(e){(e||this.$uploadElement).each((e,t)=>{r.inputFileReset(t)})}}class F{constructor(e){this.name="Queue",this.parent=e,this.options=e.options.queue,this.items={ids:[],files:[]},this.style="list",this.$queue=r.findDOM(e.$container,"element","queue").children("ul"),this.keyboardEvent=new v(e.options.eventPrefixName,[{key:"ctrl",code:17},{key:"cmd",code:91}])}init(){this.options.height&&r.findDOM(this.parent.$container,"comp","queue").height(this.options.height),this.changeStyle(this.options.style),this.options.datas&&this.import(this.options.datas)}initSelectQueueEvent(e){e.on("click",e=>this.selectQueue(o()(e.currentTarget).data("id")))}createNavigationButtons(e,t){if(!e||!e.length)return;let i=[];return e.forEach(e=>{if(!e.name||!e.iconName||!e.action)return;if(e.show&&!1===e.show(t))return;let r=e.className?`class="${e.className}"`:"",s=o()(`<button type="button" title="${e.name}" ${r}>`+`<i class="material-icons">${e.iconName}</i>`+"</button>");s.on("click",i=>{e.action(this.parent,t),i.stopPropagation()}),i.push(s)}),i}findItem(e){let t=this.items.ids.indexOf(Number(e));return"number"==typeof t?t:void 0}changeStyle(e){this.$queue.removeClass(`style-${this.style}`).addClass(`style-${e}`),this.style=e,this.parent.eventReceiver("queue.changeStyle",{style:e})}import(e){e&&("string"==typeof e?o.a.get(e,e=>{if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}e&&e instanceof Array?e.length&&e.forEach(e=>{this.addComplete(e)}):alert(y("error_import"))}):e instanceof Array&&e.forEach(e=>{this.addComplete(e)}))}delete(e){e&&e.length&&e.forEach(e=>{this.removeQueue(e,!1,!0)})}selectQueue(e){const t=this.$queue.children();if(e){let i=this.selectQueueElement(e);if(this.keyboardEvent.isPressKeyCode)i.toggleClass("selected");else{let e=i.hasClass("selected"),r=t.filter(".selected").length;t.removeClass("selected"),(!e||r>1)&&i.addClass("selected")}}else t.filter(".selected").length>0?t.removeClass("selected"):t.addClass("selected");this.parent.eventReceiver("queue.selectQueue",{$selectElements:this.$queue.children(".selected"),$selectElement:e?this.selectQueueElement(e):t.eq(0)})}selectQueueElement(e=null){return this.$queue.children(`li[data-id=${e}]`)}add(e){e.fullSrc=this.parent.options.srcPrefixName+e.src,this.items.ids.push(Number(e.id)),this.items.files.push(e)}remove(e){let t=this.findItem(e);this.items.ids.splice(t,1),this.items.files.splice(t,1)}addProgress(e){let t=o()(s.loading),i=r.findDOM(t,"element","removeQueue").children("button");this.add(e),t.attr("data-id",e.id),r.findDOM(t,"text","filename").text(e.name),r.findDOM(t,"element","progress").width("0%").find("em").text("0"),i.on("click",e=>{const t=parseInt(o()(e.currentTarget).closest("li").data("id"));this.removeQueue(t,!0,!1),this.parent.uploader.readyItems.forEach((e,i)=>{if(e.id===t)return this.parent.uploader.readyItems.splice(i,1),!1})}),this.$queue.append(t),this.parent.eventReceiver("queue.addProgress",{$el:t,file:e})}addComplete(e,t=null){let i=e.id,n=o()(s.complete),a=r.findDOM(n,"element","previewImage"),l=r.findDOM(n,"element","customButtons"),u=r.findDOM(n,"text","filetype"),d=r.findDOM(n,"text","filename"),p=r.findDOM(n,"text","state"),c=r.findDOM(n,"text","filesize");this.add(e),n.attr("data-id",i),u.text(e.type),d.text(e.name),p.text("uploaded"),c.text(e.size?r.bytesToSize(e.size):"none"),l.html(""),"image"===e.type.split("/")[0]&&a.css("background-image",`url(${e.fullSrc})`),this.initSelectQueueEvent(n);let h=this.createNavigationButtons(this.options.buttons,e);h&&h.length&&l.append(h),t&&t.length?t.after(n):this.$queue.append(n),this.parent.eventReceiver("queue.uploadComplete",{$selectElement:n,id:i,file:e})}addError(e,t){const i=e.id,n=o()(s.error),a=r.findDOM(n,"text","filetype"),l=r.findDOM(n,"text","filename"),u=r.findDOM(n,"text","state");this.add(e),n.attr("data-id",i),a.text(e.type),l.text(e.name),u.text(e.message),t&&t.length?t.after(n):this.$queue.append(n),setTimeout(()=>{this.removeQueue(i,!1,!1)},3e3)}removeQueue(e,t,i=!1){const s=this,n=this.parent,{options:a}=n;function l(e){s.selectQueueElement(e).fadeOut(400,function(){o()(this).remove(),s.remove(e),s.parent.eventReceiver("queue.removeQueue",{})})}if(t)this.selectQueueElement(e).filter(".loading").remove(),this.parent.eventReceiver("queue.removeQueue",{});else{let t=this.items.files[this.findItem(e)];if(t<0)return console.error("Not found queue id"),!1;i&&a.removeScript&&!t.isLocalFile?(r.checkFunction(a.removeParamsFilter)&&(t=a.removeParamsFilter(t,this.parent)),o.a.ajax({url:r.getFunctionReturn(a.removeScriptFunc,a.removeScript,t),type:"post",data:t,headers:a.removeHeaders?a.removeHeaders:a.uploadHeaders?a.uploadHeaders:null,success:function(t,i){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={state:"error",response:t}}if(r.checkFunction(a.removeDataFilter)&&(t=a.removeDataFilter(t,n)),!t||!t.state||"success"!==t.state)return alert(y("error_remove_error")),!1;l(e)}})):l(e)}}updateProgress(e){let t=this.$queue.children(`li[data-id=${e.id}]`),i=r.findDOM(t,"element","progress");if(!e||!e.data)return;let s=parseInt(e.data.loaded/e.data.total*100);i.width(`${s}%`).find("em").text(s),this.parent.eventReceiver("queue.updateProgress",{$selectElement:t,id:e.id,loaded:e.data.loaded,total:e.data.total})}uploadResult(e,t){if(!e)return!1;let i=this.selectQueueElement(t.id);switch(this.remove(t.id),e){case"success":this.addComplete(t,i);break;case"error":this.addError(t,i)}this.removeQueue(t.id,!0)}getSize(){let e=0;return this.items.files.forEach(t=>{e+=t.size}),e}changeId(e,t){if(void 0===t)return;const{files:i,ids:r}=this.items;let s=this.findItem(e);if(void 0!==s){let n=this.selectQueueElement(e)[0];n&&n.setAttribute("data-id",t),r[s]=t,i[s].id=t}}}class q{constructor(e){this.parent=e,this.names=[],this.child={}}eventListener(e,t){this.names.forEach(i=>{let r=this.child[i].eventListener;r&&"function"==typeof r&&r(e,t)})}error(e){this.names.splice(this.names.indexOf(e),1),delete this.child[e]}init(){let e=this.parent.options.plugin;e&&e.length&&e.forEach(e=>{e.name&&e.obj&&"object"==typeof e.obj&&e.obj.init&&"function"==typeof e.obj.init&&(this.names.push(e.name),this.child[e.name]=e.obj,this.child[e.name].init(this.parent))})}}i(1),i(2),t.default=class{constructor(e,t=null){e&&(this.options={...m,...t},t&&t.queue&&(this.options.queue={...m.queue,...t.queue}),this.$container=o()(e),this.plugin=new q(this),this.queue=new F(this),this.uploader=new E(this),this.plugin.init(),this.queue.init(),this.options.init&&"function"==typeof this.options.init&&this.options.init(this))}eventReceiver(e,t){this.plugin.eventListener(e,t)}}}]).default});