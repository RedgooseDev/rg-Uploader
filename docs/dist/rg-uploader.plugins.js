!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.plugins=t():(e.RG_Uploader=e.RG_Uploader||{},e.RG_Uploader.plugins=t())}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=0)}([function(e,t,n){"use strict";function i(e,t){this.name="Change Queue",this.sortable=null;var n=t||n||jQuery,i=this,o=null;function r(){for(var e=[],t=[],r=o.queue.$queue.children("li").map(function(){return o.queue.findItem(n(this).data("id"))}),s=0;s<r.length;s++)e.push(o.queue.items.ids[r[s]]),t.push(o.queue.items.files[r[s]]);o.queue.items.ids=e,o.queue.items.files=t,i.options.endChangeItem&&"function"==typeof i.options.endChangeItem&&i.options.endChangeItem(o)}n&&(this.init=function(t){o=t,this.options=this.assignOption(e),function(){var e=n.Deferred();if(i.options.class_sortable&&"Sortable"===i.options.class_sortable.name)return window.loadedVendorSortable=!0,window.Sortable=i.options.class_sortable,setTimeout(e.resolve,100),e.promise();if(window.loadedVendorSortable)e.resolve();else{var t=document.getElementsByTagName("head")[0],o=document.createElement("script");o.src=i.options.url_sortable,t.appendChild(o);var r=setInterval(function(){try{Sortable&&(clearInterval(r),window.loadedVendorSortable=!0,e.resolve())}catch(e){}},50)}return e.promise()}().done(function(){o.queue.$queue.addClass("rg-plugin-changeQueue"),i.options.vendorOptions.onEnd=r,i.sortable=new Sortable(o.queue.$queue.get(0),i.options.vendorOptions)})},this.eventListener=function(e,t){switch(e){case"queue.uploadCompleteAll":r()}},this.assignOption=function(e){return{...this.options,...e}})}n.r(t),i.prototype.options={class_sortable:null,url_sortable:"https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js",vendorOptions:{animation:150},endChangeItem:null};var o=i;var r=function(e,t){var n=t||n||jQuery,i=this,o=null;function r(){n.each(i.buttonsParams,function(e,t){var r=n('<button type="button" class="style-'+t.name+'" title="'+t.title+'" data-style="'+t.name+'"><i class="material-icons">'+t.iconName+"</i></button>");!function(e){e.on("click",function(e){if(n(this).hasClass("on"))return!1;o.queue.changeStyle(n(this).data("style"))})}(r),i.$nav.append(r)}),i.$buttons=i.$nav.children("button")}function s(){i.$buttons.removeClass("on").filter(".style-"+name).addClass("on")}n&&(this.name="Change Queue Style",this.buttonsParams=[{name:"list",title:"list style",iconName:"menu",default:!0},{name:"web",title:"web style",iconName:"view_list",default:!1},{name:"album",title:"album style",iconName:"view_module",default:!1}],this.$nav=null,this.$buttons=null,this.init=function(t){o=t;var a=e?n(e):o.$container.children("header");i.$nav=n('<nav data-element="selectQueueStyle"></nav>'),a.append(i.$nav),r(),s(o.queue.style)},this.eventListener=function(e,t){switch(e){case"queue.changeStyle":s(t.style)}})};var s=function(e,t){this.name="Drag And Drop",this.areaElements=[];var n=t||n||jQuery,i=this,o=null;if(n){var r=function(e){if(o.uploader.uploading)return alert(o.lang("error_add_upload")),!1;o.uploader.start(e||[])};this.init=function(t){o=t;var s=e?n(e):null;if(this.areaElements.push(o.queue.$queue.parent().get(0)),s&&s.each(function(){i.areaElements.push(this)}),this.areaElements.length){var a=function(e){if(!(window.File&&window.FileList&&window.FileReader&&window.Blob))return!1;if(!e.length)return!1;for(var t=n.Deferred(),i=!1,o=function(e){if(e.stopPropagation(),e.preventDefault(),"dragover"===e.type){if(i)return!1;i=!0,n(e.currentTarget).addClass("drop-mode"),e.dataTransfer.dropEffect="copy"}else i=!1,n(e.currentTarget).removeClass("drop-mode");return!1},r=function(e){e.stopPropagation(),e.preventDefault(),o(e);var n=e.dataTransfer?e.dataTransfer.files:null;return n&&n.length&&t.notify(n),!1},s=0;s<e.length;s++)e[s].addEventListener("dragover",o,!1),e[s].addEventListener("dragleave",o,!1),e[s].addEventListener("drop",r,!1);return t.promise()}(this.areaElements);a&&a.progress&&a.progress(r)}}}};var a=function(e){this.name="Preview",this.$preview=null;var t=e||t||jQuery,n=this,i=null,o=150;if(t){var r=function(e){var t=n.$preview.children("figure");e?t.css("backgroundImage","url('"+e+"')").removeClass("not-image"):t.attr("style","").addClass("not-image")};this.init=function(e){i=e,o=parseInt(i.options.queue.height||e.$container.find(".body").height()),e.$container.find(".body").height(o),n.$preview=t('<div class="col preview"><figure></figure></div>'),n.$preview.width(o),i.$container.find("[data-comp=queue]").prepend(n.$preview),r()},this.eventListener=function(e,t){switch(e){case"queue.selectQueue":var o=t.$selectElement.data("id"),s=i.queue.findItem(o),a=i.queue.items.files[s],l=t.$selectElement.hasClass("selected")&&"image"===a.type.split("/")[0]?a.fullSrc:null;r(l);break;case"queue.changeStyle":"list"===t.style?n.$preview.removeClass("hide"):n.$preview.addClass("hide")}}}};var l=function(e,t){this.name="Size info",this.size={current:0,total:0};var n=t||n||jQuery,i=this,o=null,r=null,s=null,a=null;function l(e){if(0===e)return"0";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","KB","MB","GB","TB"][t]}n&&(this.init=function(t){o=t,(r=e?n(e):o.$container.find(".size-info")).length||o.plugin.error(name),r.append('<p>Size : <em data-text="currentSize"></em>/<em data-text="totalSize"></em></p>'),s=r.find("[data-text=currentSize]"),a=r.find("[data-text=totalSize]"),this.size.total=o.options.limitSizeTotal,this.update()},this.update=function(){s.text(l(this.size.current)),a.text(l(this.size.total))},this.eventListener=function(e,t){switch(e){case"queue.uploadComplete":i.size.current+=t.file.size,i.update(o.queue.getSize());break;case"queue.removeQueue":i.size.current=o.queue.getSize(),i.update()}})};function u(e,t){this.name="Make thumbnail";var n=t||n||jQuery,i=this,o=null,r="resize.rgUploader",s=!1,a=null;function l(e){if(!e&&s)return!1;s=!0,i.$el.wrap.width("100%").height("100%").css({marginLeft:0,marginTop:0,left:0,top:0}),i.croppie&&c(!0)}function u(e){if(!e&&!s)return!1;s=!1,i.$el.wrap.width(i.options.width).height(i.options.height).css({marginLeft:0-.5*i.options.width+"px",marginTop:0-.5*i.options.height+"px",left:"50%",top:"50%"}),i.croppie&&c(!0)}function p(e){var t=n(window);if(!i.croppie)return clearTimeout(a),!1;a&&clearTimeout(a),a=setTimeout(function(){if(s&&t.width()<640)return l(!0),!1;t.width()<640?l(!0):t.width()>640&&u(!0)},300)}function c(e){var t=e?i.croppie.get():{};d(),i.options.croppie.boundary={width:i.options.mobileSize>n(window).width()?n(window).width():i.options.width,height:(i.options.mobileSize>n(window).width()?n(window).height():i.options.height)-60},i.croppie=new Croppie(i.$el.figure.get(0),i.options.croppie),e&&i.rebind({src:i.file.fullSrc,points:t.points},function(){i.croppie.setZoom(t.zoom)})}function d(){i.croppie&&(i.croppie.destroy(),i.croppie=null)}function f(e){i.croppie.result(i.options.output).then(function(e){i.options.uploadScript?n.post(i.options.uploadScript,{name:i.file.name,image:e,id:h()},function(e){try{e=JSON.parse(e)}catch(e){return alert("parse error"),!1}if("error"===e.state)return alert(e.response.message),!1;i.options.doneCallback&&i.options.doneCallback(e.response,o,i.file)}):i.options.doneCallback&&i.options.doneCallback({id:h(),name:"thumb-"+i.file.name,src:e,type:"image/"+i.options.output.format,size:0},o,i.file),i.close()},function(e){console.log("ERROR",e)})}function h(e){e=e||10;for(var t,n,i=(+new Date).toString().split("").reverse(),o="",r=0;r<e;++r){o+=i[(t=0,n=i.length-1,Math.floor(Math.random()*(n-t+1))+t)]}return parseInt(o)}n&&(this.file=null,this.croppie=null,this.$el={con:null,wrap:null,bg:null,figure:null,meta:null,btn_close:null,btn_done:null},this.init=function(t){o=t,this.assignOption(e),function(){if(!window.loadedCroppie){var e=document.getElementsByTagName("head")[0],t=!!i.options.class_croppie&&"Croppie"===i.options.class_croppie.name;if(t&&(window.Croppie=i.options.class_croppie),!t&&i.options.url_croppieJS){var n=document.createElement("script");n.src=i.options.url_croppieJS,e.appendChild(n)}if(i.options.url_croppieCSS){var o=document.createElement("link");o.rel="stylesheet",o.href=i.options.url_croppieCSS,e.appendChild(o)}window.loadedCroppie=!0}}(),i.$el.con=n('<div class="rg-plugin-thumbnail"><span class="bg"></span><div class="wrap"><div class="img-wrap"><figure></figure></div><div class="body"><div class="meta"><p>message</p></div><nav><button type="button" class="btn-done"><i class="material-icons">done</i></button><button type="button" class="btn-close"><i class="material-icons">close</i></button></nav></div></div></div>'),i.$el.wrap=i.$el.con.children(".wrap"),i.$el.bg=i.$el.con.children(".bg"),i.$el.figure=i.$el.con.find(".img-wrap figure"),i.$el.meta=i.$el.con.find(".meta > p"),i.$el.btn_done=i.$el.con.find(".btn-done"),i.$el.btn_close=i.$el.con.find(".btn-close"),n("body").append(i.$el.con),i.$el.bg.on("click",function(){i.close()}),i.$el.btn_close.on("click",function(){i.close()}),i.$el.btn_done.on("click",f),n(window).on(r,p)},this.open=function(e,t){t=t||{},this.$el.con.addClass("show"),n("html").addClass("rg-popup"),this.file=e,n(window).width()<this.options.mobileSize?l(!0):u(!0),c(),this.rebind({src:this.file.fullSrc,points:t.points,orientation:t.orientation},function(){i.croppie.setZoom(t.zoom||.1)}),this.$el.meta.text("output size: "+this.options.output.size.width+"*"+this.options.output.size.height),this.options.openCallback&&this.options.openCallback(o)},this.close=function(){d(),this.file=null,this.$el.con.removeClass("show"),n("html").removeClass("rg-popup"),this.options.closeCallback&&this.options.closeCallback(o)},this.rebind=function(e,t){this.croppie.bind({url:e.src,points:e.points?e.points:[],orientation:e.orientation?e.orientation:1},function(){t&&t()})},this.assignOption=function(e){this.options=n.extend(!0,this.options,e)})}u.prototype.options={width:640,height:480,mobileSize:640,class_croppie:null,url_croppieCSS:"https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.4/croppie.min.css",url_croppieJS:"https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.4/croppie.min.js",uploadScript:"",output:{type:"canvas",quality:.75,format:"jpeg",size:{width:150,height:150}},croppie:{enableOrientation:!0,boundary:{width:640,height:420},viewport:{width:150,height:150,type:"square"}},doneCallback:null,openCallback:null,closeCallback:null};var p=u;n.d(t,"ChangeQueue",function(){return o}),n.d(t,"ChangeQueueStyle",function(){return r}),n.d(t,"DragAndDrop",function(){return s}),n.d(t,"Preview",function(){return a}),n.d(t,"SizeInfo",function(){return l}),n.d(t,"Thumbnail",function(){return p})}])});